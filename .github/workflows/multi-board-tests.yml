name: StarForgeOS Multi-Board Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  # Build and test for ESP32-C3
  test-esp32-c3:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for ESP32-C3
        run: pio run -e esp32-c3-supermini
      
      - name: Run Tests for ESP32-C3
        working-directory: ./test
        run: |
          pio test -e test-esp32-c3 --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for ESP32-C3"
      
      - name: Upload ESP32-C3 Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-esp32-c3
          path: .pio/build/esp32-c3-supermini/firmware.bin
          retention-days: 30

  # Build (and optionally test) for NuclearCounter (ESP32-C3 based)
  test-nuclearcounter:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for NuclearCounter
        run: pio run -e nuclearcounter
      
      # Reuse the generic C3 unit tests for now (logic is the same), or just ensure build succeeds
      - name: Run Tests for NuclearCounter (reusing ESP32-C3 tests)
        working-directory: ./test
        run: |
          pio test -e test-esp32-c3 --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for NuclearCounter"
      
      - name: Upload NuclearCounter Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-nuclearcounter
          path: .pio/build/nuclearcounter/firmware.bin
          retention-days: 30

  # Build and test for ESP32-C6
  test-esp32-c6:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for ESP32-C6
        run: pio run -e esp32-c6
      
      - name: Run Tests for ESP32-C6
        working-directory: ./test
        run: |
          pio test -e test-esp32-c6 --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for ESP32-C6"
      
      - name: Upload ESP32-C6 Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-esp32-c6
          path: .pio/build/esp32-c6/firmware.bin
          retention-days: 30

  # Build and test for Generic ESP32
  test-esp32:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for ESP32
        run: pio run -e esp32dev
      
      - name: Run Tests for ESP32
        working-directory: ./test
        run: |
          pio test -e test-esp32 --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for ESP32"
      
      - name: Upload ESP32 Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-esp32
          path: .pio/build/esp32dev/firmware.bin
          retention-days: 30

  # Build and test for ESP32-S2
  test-esp32-s2:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for ESP32-S2
        run: pio run -e esp32-s2
      
      - name: Run Tests for ESP32-S2
        working-directory: ./test
        run: |
          pio test -e test-esp32-s2 --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for ESP32-S2"
      
      - name: Upload ESP32-S2 Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-esp32-s2
          path: .pio/build/esp32-s2/firmware.bin
          retention-days: 30

  # Build and test for ESP32-S3
  test-esp32-s3:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for ESP32-S3
        run: pio run -e esp32-s3
      
      - name: Run Tests for ESP32-S3
        working-directory: ./test
        run: |
          pio test -e test-esp32-s3 --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for ESP32-S3"
      
      - name: Upload ESP32-S3 Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-esp32-s3
          path: .pio/build/esp32-s3/firmware.bin
          retention-days: 30

  # Build and test for ESP32-S3-T-Energy (LilyGo T-Energy with battery)
  test-esp32-s3-t-energy:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for ESP32-S3-T-Energy
        run: pio run -e esp32-s3-t-energy
      
      - name: Run Tests for ESP32-S3-T-Energy
        working-directory: ./test
        run: |
          pio test -e test-esp32-s3-t-energy --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for ESP32-S3-T-Energy"
      
      - name: Upload ESP32-S3-T-Energy Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-esp32-s3-t-energy
          path: .pio/build/esp32-s3-t-energy/firmware.bin
          retention-days: 30

  # Build and test for ESP32-S3-Touch (Waveshare)
  test-esp32-s3-touch:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for ESP32-S3-Touch
        run: pio run -e esp32-s3-touch
      
      - name: Run Tests for ESP32-S3-Touch
        working-directory: ./test
        run: |
          pio test -e test-esp32-s3-touch --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for ESP32-S3-Touch"
      
      - name: Upload ESP32-S3-Touch Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-esp32-s3-touch
          path: .pio/build/esp32-s3-touch/firmware.bin
          retention-days: 30

  # Build and test for JC2432W328C
  test-jc2432w328c:
    # Security: Only use self-hosted runner for trusted events
    runs-on: self-hosted
    if: |
      (github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')) ||
      github.event_name == 'workflow_dispatch' ||
      (github.event_name == 'pull_request' && github.event.pull_request.head.repo.full_name == github.repository)
    steps:
      - name: Clean up any stale repository state
        if: runner.os == 'Linux'
        run: |
          # Remove any existing repository to prevent state conflicts
          if [ -d "${{ github.workspace }}" ] && [ -d "${{ github.workspace }}/.git" ]; then
            echo "Cleaning up stale repository state..."
            rm -rf "${{ github.workspace }}"/* "${{ github.workspace }}"/.* 2>/dev/null || true
          fi
      
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history (not shallow clone)
          fetch-tags: true  # Fetch all tags to prevent "bad object" errors
          ref: ${{ github.ref }}  # Explicitly set the ref
      
      - name: Verify repository state
        shell: bash
        run: |
          echo "Verifying repository state..."
          # Quick check - only verify if we can access the current ref
          if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
            echo "⚠️ Repository state issue detected, attempting to repair..."
            git fetch --all --tags --force || true
            git gc --prune=now || true
          fi
          echo "✅ Repository state verified"
      
      # For self-hosted runners, PlatformIO packages persist in ~/.platformio
      - name: Check PlatformIO cache
        run: |
          echo "PlatformIO packages location: ~/.platformio"
          du -sh ~/.platformio 2>/dev/null || echo "No PlatformIO cache yet"
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install platformio
          pio --version
      
      - name: Build for JC2432W328C
        run: pio run -e jc2432w328c
      
      - name: Run Tests for JC2432W328C
        working-directory: ./test
        run: |
          pio test -e test-jc2432w328c --without-uploading --without-testing || echo "Tests cannot run without hardware"
          echo "Build successful for JC2432W328C"
      
      - name: Upload JC2432W328C Firmware
        uses: actions/upload-artifact@v4
        with:
          name: firmware-jc2432w328c
          path: .pio/build/jc2432w328c/firmware.bin
          retention-days: 30

  # Generate test report summary
  test-summary:
    runs-on: ubuntu-latest
    needs: [test-esp32-c3, test-nuclearcounter, test-esp32-c6, test-esp32, test-esp32-s2, test-esp32-s3, test-esp32-s3-t-energy, test-esp32-s3-touch, test-jc2432w328c]
    if: always()
    steps:
      - name: Generate Test Summary
        run: |
          echo "# StarForgeOS Multi-Board Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Build Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Board | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-C3 | ${{ needs.test-esp32-c3.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| NuclearCounter | ${{ needs.test-nuclearcounter.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-C6 | ${{ needs.test-esp32-c6.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32 | ${{ needs.test-esp32.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-S2 | ${{ needs.test-esp32-s2.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-S3 | ${{ needs.test-esp32-s3.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-S3-T-Energy | ${{ needs.test-esp32-s3-t-energy.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-S3-Touch | ${{ needs.test-esp32-s3-touch.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| JC2432W328C | ${{ needs.test-jc2432w328c.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Firmware artifacts are available for download for 30 days." >> $GITHUB_STEP_SUMMARY
